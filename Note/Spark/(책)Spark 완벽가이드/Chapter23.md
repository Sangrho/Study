### CHAPTER 23 운영 환경에서의 구조적 스트리밍   
  
#### 23.1 내고장성과 체크포인팅  
구조적 스트리밍 애플리케이션은 단순한 재시작만으로 왠만한 장애 상황을 극복한다.  
이를 위해 스파크 엔진이 자동으로 관리하는 체크포인트와 WAL 를 사용하도록 설정해야 한다.  
이는 곧 체크포인팅과 WAL 정보를 저장하는 신뢰도 높은 파일 시스템의 체크포인트 경로를 쿼리에 설정해야 한다.  
장애 상황이 발생하면 단순히 애플리케이션을 다시 시작하여 중간 상탯값을 저장한 체크 포인트 ㄱ여로를 참조하도록 설정한다.  
  
```python  
static = spark.read.json("data")  
streaming = spark.readStream \  
	.schema(static.schema) \  
	.json("data") \  
	.count()  
  
query = streaming \  
	.writeStream \  
	.outputMode("complete") \  
	.option("checkpointLocation", "hdfs://asdf") \  
	.queryName("queryda") \  
	.format("memory") \  
	.start()  
```  
  
#### 23.2 애플리케이션 변경하기   
주의해야 할 점은, 스트리밍 애플리케이션을 업데이트할 때 이전 체크포인트 데이터를 고려해야 한다는 것.  
  
##### 23.2.1 스트리밍 애플리케이션 코드 업데이트하기  
구조적 스트리밍은 애플리케이션을 다시 시작하기 전에 특정 유형의 애플리케이션 코드를 변경할 수 있도록 설계되어 있다.  
버그를 수정해야 하는 상황에서 이 기능은 매우 유용하다.  
  
새로운 컬럼을 추가하거나 UDF 를 변경하는 등의 작은 수정은 체크포인트 디렉터리를 새롭게 지정해도 되지 않지만,  
스트리밍 애플리케이션에 새로운 집계 키를 추가하거나 쿼리를 완전히 변경하는 등의 업데이트가 발생하면 샐로 지정해야 한다.  
  
##### 23.2.2 스파크 버전 업데이트하기  
스파크 업그레이드와 상관없이 상위 버전과 호환된다.  
  
##### 23.2.3 애플리케이션의 초기 규모 산정과 재조정하기  
  
#### 23.3 메트릭과 모니터링   
  
##### 23.3.1 쿼리 상태  
```  
query.status  
```  
  
##### 23.3.2 최근 진행 상황  
```  
query.recentProgress  
```  
  
##### 23.3.3 스파크 UI  
  
#### 23.4 알림   
  
#### 23.5 스트리밍 리스너를 사용한 고급 모니터링   
